<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Blog-GM-incidencia - Googledrive SQLite</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "Sin resultados",
    "search-matching-documents-text": "documentos encontrados",
    "search-copy-link-title": "Copiar el enlace en la búsqueda",
    "search-hide-matches-text": "Ocultar resultados adicionales",
    "search-more-match-text": "resultado adicional en este documento",
    "search-more-matches-text": "resultados adicionales en este documento",
    "search-clear-button-title": "Borrar",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar"
  }
}</script>
<script type="module" src="../../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="../../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Blog-GM-incidencia</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Buscar"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Navegación de palanca" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">de qué trata</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Googledrive SQLite</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Fecha de publicación</div>
      <div class="quarto-title-meta-contents">
        <p class="date">1 de junio de 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="uso-de-googledrive-como-base-de-datos" class="level2">
<h2 class="anchored" data-anchor-id="uso-de-googledrive-como-base-de-datos">Uso de GoogleDrive como Base de datos</h2>
<p>Este documento ejemplifica el uso de Google Drive como base de datos. Además, es un ensayo de uso de <em>Observable JS</em> como base para aplicaciones interactivas. Puede aprenderse un poco más sobre esto en <a href="https://quarto.org/docs/interactive/ojs/" class="uri">https://quarto.org/docs/interactive/ojs/</a>.</p>
<p>He recurrido a una pequeña herramienta que reúne toda la información referente al contenido del Google Drive a partir de una carpeta inicial. Me he apoyado en <a href="https://github.com/simonw/google-drive-to-sqlite">esta solución</a> para recabar los <em>metadatos</em> hecha en Python. Esa información la organiza en una pequeña base de datos que deposita en un archivo <strong>SQLite</strong>. La estructura de esta base de datos se ilustra a continuación:</p>
<p><img src="images/Pronaces-A.png" class="img-fluid"></p>
<p>A esta estructura de <em>metadatos</em> de <strong>Google Drive</strong> le hemos agregado espacio para reunir la tabla de conceptos y el vínculo entre documentos y conceptos. Lo hacemos mediante dos tablas adicionales. De esta manera, la estructura de la base de datos quedaría como se ilustra en seguida.</p>
<p><img src="images/conceptos.png" class="img-fluid"></p>
</section>
<section id="listas-de-metadatos-del-contenido-en-gd" class="level2">
<h2 class="anchored" data-anchor-id="listas-de-metadatos-del-contenido-en-gd">Listas de <em>metadatos</em> del contenido en GD</h2>
<p>Elige una tabla para desplegar los elementos de información recabados:</p>
<div class="cell panel-input card bg-light p-2">
<div class="sourceCode cell-code hidden" id="cb1" data-startfrom="35" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 34;"><span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>viewof tabla <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">radio</span>(</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>  [</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">"drive_folders"</span><span class="op">,</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    <span class="st">"drive_files"</span><span class="op">,</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">"drive_users"</span><span class="op">,</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">"conceptos"</span><span class="op">,</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">"tema_doc"</span><span class="op">,</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span> </span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">label</span><span class="op">:</span> <span class="st">"Tabla:"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="st">"drive_folders"</span>}</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-1" data-nodetype="declaration">

</div>
</div>
</div>
<p>Información recabada por <em>Google Drive</em> en la tabla seleccionada arriba:</p>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb2" data-startfrom="53" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 52;"><span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"pronaces.db"</span>)<span class="op">.</span><span class="fu">sqlite</span>()</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="fu">describe</span>(tabla)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-2" data-nodetype="expression">

</div>
</div>
</div>
</div>
<p>Veamos ahora el contenido de una carpeta seleccionada. Para referencia y ejemplo consideremos la carpeta <em>Libro Semillas</em>. Prácticamente todas las búsquedas programáticas que hagamos recurrirán al <strong>id</strong> único, asignado a la carpeta de interés. ¿Cuál es el <strong>id</strong> de esta carpeta?. Usemos los recursos que acabamos de describir para averiguarlo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" data-startfrom="63" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 62;"><span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>sql_id <span class="op">=</span> <span class="st">"SELECT id, name FROM drive_folders WHERE  name LIKE '%Libro semillas%'"</span></span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>resultado_1 <span class="op">=</span> db<span class="op">.</span><span class="fu">query</span>(sql_id)</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">table</span>(resultado_1<span class="op">,</span> {  <span class="dt">columns</span><span class="op">:</span> [<span class="st">"name"</span><span class="op">,</span> <span class="st">"id"</span>]})</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-3-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-3-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-3-3" data-nodetype="expression">

</div>
</div>
</div>
</div>
<p><br>
<br>
</p>
<p>Así que el <strong>id</strong> en Google Drive del documento que nos interesa es: <strong>1uOrhAvjddeDxgyfIyDaoyKNivp63vUvO</strong></p>
<p><br>
<br>
</p>
<p>Ahora podemos averiguar que documentos o carpetas están aquí. Esto depende de dos tablas diferentes: <em>drive_files</em> y <em>drive_folders</em>.</p>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb4" data-startfrom="83" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 82;"><span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a>sql_base <span class="op">=</span> <span class="st">"SELECT name, mimeType FROM drive_files WHERE _parent = '1uOrhAvjddeDxgyfIyDaoyKNivp63vUvO'"</span></span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a>viewof consulta <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">textarea</span>({<span class="dt">label</span><span class="op">:</span> <span class="st">"Consulta"</span><span class="op">,</span> </span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a>                            <span class="dt">placeholder</span><span class="op">:</span> <span class="st">"Ingresa una consulta SQL"</span><span class="op">,</span> </span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a>                            <span class="dt">value</span><span class="op">:</span> sql_base<span class="op">,</span> </span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a>                            <span class="dt">submit</span><span class="op">:</span> <span class="kw">true</span>})</span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a>fld_interes <span class="op">=</span> db<span class="op">.</span><span class="fu">query</span>(consulta)</span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">table</span>(fld_interes<span class="op">,</span> {  <span class="dt">columns</span><span class="op">:</span> [</span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a>    <span class="st">"name"</span><span class="op">,</span> <span class="st">"mimeType"</span>]})</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-4" data-nodetype="expression">

</div>
</div>
</div>
</div>
<p><br>
<br>
</p>
</section>
<section id="conceptos" class="level2">
<h2 class="anchored" data-anchor-id="conceptos">Conceptos</h2>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb5" data-startfrom="104" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 103;"><span id="cb5-104"><a href="#cb5-104" aria-hidden="true" tabindex="-1"></a>sunburst <span class="op">=</span> {</span>
<span id="cb5-105"><a href="#cb5-105" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> <span class="bu">root</span> <span class="op">=</span> <span class="fu">partition</span>(flareData)<span class="op">;</span></span>
<span id="cb5-106"><a href="#cb5-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-107"><a href="#cb5-107" aria-hidden="true" tabindex="-1"></a>  <span class="bu">root</span><span class="op">.</span><span class="fu">each</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">current</span> <span class="op">=</span> d)<span class="op">;</span></span>
<span id="cb5-108"><a href="#cb5-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-109"><a href="#cb5-109" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb5-110"><a href="#cb5-110" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width<span class="op">,</span> width])</span>
<span id="cb5-111"><a href="#cb5-111" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"font"</span><span class="op">,</span> <span class="st">"15px sans-serif"</span>)<span class="op">;</span></span>
<span id="cb5-112"><a href="#cb5-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-113"><a href="#cb5-113" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> g <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb5-114"><a href="#cb5-114" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>width <span class="op">/</span> <span class="dv">2</span><span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>width <span class="op">/</span> <span class="dv">2</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb5-115"><a href="#cb5-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-116"><a href="#cb5-116" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> path <span class="op">=</span> g<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb5-117"><a href="#cb5-117" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"path"</span>)</span>
<span id="cb5-118"><a href="#cb5-118" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(<span class="bu">root</span><span class="op">.</span><span class="fu">descendants</span>()<span class="op">.</span><span class="fu">slice</span>(<span class="dv">1</span>))</span>
<span id="cb5-119"><a href="#cb5-119" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">join</span>(<span class="st">"path"</span>)</span>
<span id="cb5-120"><a href="#cb5-120" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> d <span class="kw">=&gt;</span> { <span class="cf">while</span> (d<span class="op">.</span><span class="at">depth</span> <span class="op">&gt;</span> <span class="dv">1</span>) d <span class="op">=</span> d<span class="op">.</span><span class="at">parent</span><span class="op">;</span> <span class="cf">return</span> <span class="fu">color</span>(d<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="at">name</span>)<span class="op">;</span> })</span>
<span id="cb5-121"><a href="#cb5-121" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill-opacity"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">arcVisible</span>(d<span class="op">.</span><span class="at">current</span>) <span class="op">?</span> (d<span class="op">.</span><span class="at">children</span> <span class="op">?</span> <span class="fl">0.6</span> <span class="op">:</span> <span class="fl">0.4</span>) <span class="op">:</span> <span class="dv">0</span>)</span>
<span id="cb5-122"><a href="#cb5-122" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">arc</span>(d<span class="op">.</span><span class="at">current</span>))<span class="op">;</span></span>
<span id="cb5-123"><a href="#cb5-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-124"><a href="#cb5-124" aria-hidden="true" tabindex="-1"></a>  path<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">children</span>)</span>
<span id="cb5-125"><a href="#cb5-125" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"cursor"</span><span class="op">,</span> <span class="st">"pointer"</span>)</span>
<span id="cb5-126"><a href="#cb5-126" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">on</span>(<span class="st">"click"</span><span class="op">,</span> clicked)<span class="op">;</span></span>
<span id="cb5-127"><a href="#cb5-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-128"><a href="#cb5-128" aria-hidden="true" tabindex="-1"></a>  path<span class="op">.</span><span class="fu">append</span>(<span class="st">"title"</span>)</span>
<span id="cb5-129"><a href="#cb5-129" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(d <span class="kw">=&gt;</span> <span class="vs">`</span><span class="sc">${</span>d<span class="op">.</span><span class="fu">ancestors</span>()<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="at">name</span>)<span class="op">.</span><span class="fu">reverse</span>()<span class="op">.</span><span class="fu">join</span>(<span class="st">"/"</span>)<span class="sc">}\n${</span><span class="fu">format</span>(d<span class="op">.</span><span class="at">value</span>)<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb5-130"><a href="#cb5-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-131"><a href="#cb5-131" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> label <span class="op">=</span> g<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb5-132"><a href="#cb5-132" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"pointer-events"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb5-133"><a href="#cb5-133" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb5-134"><a href="#cb5-134" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"user-select"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb5-135"><a href="#cb5-135" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"text"</span>)</span>
<span id="cb5-136"><a href="#cb5-136" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(<span class="bu">root</span><span class="op">.</span><span class="fu">descendants</span>()<span class="op">.</span><span class="fu">slice</span>(<span class="dv">1</span>))</span>
<span id="cb5-137"><a href="#cb5-137" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">join</span>(<span class="st">"text"</span>)</span>
<span id="cb5-138"><a href="#cb5-138" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"dy"</span><span class="op">,</span> <span class="st">"0.35em"</span>)</span>
<span id="cb5-139"><a href="#cb5-139" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill-opacity"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="op">+</span><span class="fu">labelVisible</span>(d<span class="op">.</span><span class="at">current</span>))</span>
<span id="cb5-140"><a href="#cb5-140" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">labelTransform</span>(d<span class="op">.</span><span class="at">current</span>))</span>
<span id="cb5-141"><a href="#cb5-141" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="at">name</span>)<span class="op">;</span></span>
<span id="cb5-142"><a href="#cb5-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-143"><a href="#cb5-143" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> parent <span class="op">=</span> g<span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb5-144"><a href="#cb5-144" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">datum</span>(<span class="bu">root</span>)</span>
<span id="cb5-145"><a href="#cb5-145" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> radius)</span>
<span id="cb5-146"><a href="#cb5-146" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb5-147"><a href="#cb5-147" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"pointer-events"</span><span class="op">,</span> <span class="st">"all"</span>)</span>
<span id="cb5-148"><a href="#cb5-148" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">on</span>(<span class="st">"click"</span><span class="op">,</span> clicked)<span class="op">;</span></span>
<span id="cb5-149"><a href="#cb5-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-150"><a href="#cb5-150" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">clicked</span>(<span class="bu">event</span><span class="op">,</span> p) {</span>
<span id="cb5-151"><a href="#cb5-151" aria-hidden="true" tabindex="-1"></a>    parent<span class="op">.</span><span class="fu">datum</span>(p<span class="op">.</span><span class="at">parent</span> <span class="op">||</span> <span class="bu">root</span>)<span class="op">;</span></span>
<span id="cb5-152"><a href="#cb5-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-153"><a href="#cb5-153" aria-hidden="true" tabindex="-1"></a>    <span class="bu">root</span><span class="op">.</span><span class="fu">each</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">target</span> <span class="op">=</span> {</span>
<span id="cb5-154"><a href="#cb5-154" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x0</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="dv">1</span><span class="op">,</span> (d<span class="op">.</span><span class="at">x0</span> <span class="op">-</span> p<span class="op">.</span><span class="at">x0</span>) <span class="op">/</span> (p<span class="op">.</span><span class="at">x1</span> <span class="op">-</span> p<span class="op">.</span><span class="at">x0</span>))) <span class="op">*</span> <span class="dv">2</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">,</span></span>
<span id="cb5-155"><a href="#cb5-155" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="dv">1</span><span class="op">,</span> (d<span class="op">.</span><span class="at">x1</span> <span class="op">-</span> p<span class="op">.</span><span class="at">x0</span>) <span class="op">/</span> (p<span class="op">.</span><span class="at">x1</span> <span class="op">-</span> p<span class="op">.</span><span class="at">x0</span>))) <span class="op">*</span> <span class="dv">2</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">,</span></span>
<span id="cb5-156"><a href="#cb5-156" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y0</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> d<span class="op">.</span><span class="at">y0</span> <span class="op">-</span> p<span class="op">.</span><span class="at">depth</span>)<span class="op">,</span></span>
<span id="cb5-157"><a href="#cb5-157" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> d<span class="op">.</span><span class="at">y1</span> <span class="op">-</span> p<span class="op">.</span><span class="at">depth</span>)</span>
<span id="cb5-158"><a href="#cb5-158" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb5-159"><a href="#cb5-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-160"><a href="#cb5-160" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> t <span class="op">=</span> g<span class="op">.</span><span class="fu">transition</span>()<span class="op">.</span><span class="fu">duration</span>(<span class="dv">750</span>)<span class="op">;</span></span>
<span id="cb5-161"><a href="#cb5-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-162"><a href="#cb5-162" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Transition the data on all arcs, even the ones that aren’t visible,</span></span>
<span id="cb5-163"><a href="#cb5-163" aria-hidden="true" tabindex="-1"></a>    <span class="co">// so that if this transition is interrupted, entering arcs will start</span></span>
<span id="cb5-164"><a href="#cb5-164" aria-hidden="true" tabindex="-1"></a>    <span class="co">// the next transition from the desired position.</span></span>
<span id="cb5-165"><a href="#cb5-165" aria-hidden="true" tabindex="-1"></a>    path<span class="op">.</span><span class="fu">transition</span>(t)</span>
<span id="cb5-166"><a href="#cb5-166" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">tween</span>(<span class="st">"data"</span><span class="op">,</span> d <span class="kw">=&gt;</span> {</span>
<span id="cb5-167"><a href="#cb5-167" aria-hidden="true" tabindex="-1"></a>          <span class="kw">const</span> i <span class="op">=</span> d3<span class="op">.</span><span class="fu">interpolate</span>(d<span class="op">.</span><span class="at">current</span><span class="op">,</span> d<span class="op">.</span><span class="at">target</span>)<span class="op">;</span></span>
<span id="cb5-168"><a href="#cb5-168" aria-hidden="true" tabindex="-1"></a>          <span class="cf">return</span> t <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">current</span> <span class="op">=</span> <span class="fu">i</span>(t)<span class="op">;</span></span>
<span id="cb5-169"><a href="#cb5-169" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb5-170"><a href="#cb5-170" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">filter</span>(<span class="kw">function</span>(d) {</span>
<span id="cb5-171"><a href="#cb5-171" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">+</span><span class="kw">this</span><span class="op">.</span><span class="fu">getAttribute</span>(<span class="st">"fill-opacity"</span>) <span class="op">||</span> <span class="fu">arcVisible</span>(d<span class="op">.</span><span class="at">target</span>)<span class="op">;</span></span>
<span id="cb5-172"><a href="#cb5-172" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb5-173"><a href="#cb5-173" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill-opacity"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">arcVisible</span>(d<span class="op">.</span><span class="at">target</span>) <span class="op">?</span> (d<span class="op">.</span><span class="at">children</span> <span class="op">?</span> <span class="fl">0.6</span> <span class="op">:</span> <span class="fl">0.4</span>) <span class="op">:</span> <span class="dv">0</span>)</span>
<span id="cb5-174"><a href="#cb5-174" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attrTween</span>(<span class="st">"d"</span><span class="op">,</span> d <span class="kw">=&gt;</span> () <span class="kw">=&gt;</span> <span class="fu">arc</span>(d<span class="op">.</span><span class="at">current</span>))<span class="op">;</span></span>
<span id="cb5-175"><a href="#cb5-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-176"><a href="#cb5-176" aria-hidden="true" tabindex="-1"></a>    label<span class="op">.</span><span class="fu">filter</span>(<span class="kw">function</span>(d) {</span>
<span id="cb5-177"><a href="#cb5-177" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">+</span><span class="kw">this</span><span class="op">.</span><span class="fu">getAttribute</span>(<span class="st">"fill-opacity"</span>) <span class="op">||</span> <span class="fu">labelVisible</span>(d<span class="op">.</span><span class="at">target</span>)<span class="op">;</span></span>
<span id="cb5-178"><a href="#cb5-178" aria-hidden="true" tabindex="-1"></a>      })<span class="op">.</span><span class="fu">transition</span>(t)</span>
<span id="cb5-179"><a href="#cb5-179" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill-opacity"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="op">+</span><span class="fu">labelVisible</span>(d<span class="op">.</span><span class="at">target</span>))</span>
<span id="cb5-180"><a href="#cb5-180" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attrTween</span>(<span class="st">"transform"</span><span class="op">,</span> d <span class="kw">=&gt;</span> () <span class="kw">=&gt;</span> <span class="fu">labelTransform</span>(d<span class="op">.</span><span class="at">current</span>))<span class="op">;</span></span>
<span id="cb5-181"><a href="#cb5-181" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-182"><a href="#cb5-182" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-183"><a href="#cb5-183" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">arcVisible</span>(d) {</span>
<span id="cb5-184"><a href="#cb5-184" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> d<span class="op">.</span><span class="at">y1</span> <span class="op">&lt;=</span> <span class="dv">3</span> <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">y0</span> <span class="op">&gt;=</span> <span class="dv">1</span> <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">x1</span> <span class="op">&gt;</span> d<span class="op">.</span><span class="at">x0</span><span class="op">;</span></span>
<span id="cb5-185"><a href="#cb5-185" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-186"><a href="#cb5-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-187"><a href="#cb5-187" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">labelVisible</span>(d) {</span>
<span id="cb5-188"><a href="#cb5-188" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> d<span class="op">.</span><span class="at">y1</span> <span class="op">&lt;=</span> <span class="dv">3</span> <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">y0</span> <span class="op">&gt;=</span> <span class="dv">1</span> <span class="op">&amp;&amp;</span> (d<span class="op">.</span><span class="at">y1</span> <span class="op">-</span> d<span class="op">.</span><span class="at">y0</span>) <span class="op">*</span> (d<span class="op">.</span><span class="at">x1</span> <span class="op">-</span> d<span class="op">.</span><span class="at">x0</span>) <span class="op">&gt;</span> <span class="fl">0.03</span><span class="op">;</span></span>
<span id="cb5-189"><a href="#cb5-189" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-190"><a href="#cb5-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-191"><a href="#cb5-191" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">labelTransform</span>(d) {</span>
<span id="cb5-192"><a href="#cb5-192" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> x <span class="op">=</span> (d<span class="op">.</span><span class="at">x0</span> <span class="op">+</span> d<span class="op">.</span><span class="at">x1</span>) <span class="op">/</span> <span class="dv">2</span> <span class="op">*</span> <span class="dv">180</span> <span class="op">/</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">;</span></span>
<span id="cb5-193"><a href="#cb5-193" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> y <span class="op">=</span> (d<span class="op">.</span><span class="at">y0</span> <span class="op">+</span> d<span class="op">.</span><span class="at">y1</span>) <span class="op">/</span> <span class="dv">2</span> <span class="op">*</span> radius<span class="op">;</span></span>
<span id="cb5-194"><a href="#cb5-194" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="vs">`rotate(</span><span class="sc">${</span>x <span class="op">-</span> <span class="dv">90</span><span class="sc">}</span><span class="vs">) translate(</span><span class="sc">${</span>y<span class="sc">}</span><span class="vs">,0) rotate(</span><span class="sc">${</span>x <span class="op">&lt;</span> <span class="dv">180</span> <span class="op">?</span> <span class="dv">0</span> <span class="op">:</span> <span class="dv">180</span><span class="sc">}</span><span class="vs">)`</span><span class="op">;</span></span>
<span id="cb5-195"><a href="#cb5-195" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-196"><a href="#cb5-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-197"><a href="#cb5-197" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb5-198"><a href="#cb5-198" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb6" data-startfrom="206" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 205;"><span id="cb6-206"><a href="#cb6-206" aria-hidden="true" tabindex="-1"></a>flareData <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"data/flare-2.json"</span>)<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb6-207"><a href="#cb6-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-208"><a href="#cb6-208" aria-hidden="true" tabindex="-1"></a>partition <span class="op">=</span> flareData <span class="kw">=&gt;</span> {</span>
<span id="cb6-209"><a href="#cb6-209" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> <span class="bu">root</span> <span class="op">=</span> d3<span class="op">.</span><span class="fu">hierarchy</span>(flareData)</span>
<span id="cb6-210"><a href="#cb6-210" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">sum</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">value</span>)</span>
<span id="cb6-211"><a href="#cb6-211" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> b<span class="op">.</span><span class="at">value</span> <span class="op">-</span> a<span class="op">.</span><span class="at">value</span>)<span class="op">;</span></span>
<span id="cb6-212"><a href="#cb6-212" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> d3<span class="op">.</span><span class="fu">partition</span>()</span>
<span id="cb6-213"><a href="#cb6-213" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">size</span>([<span class="dv">2</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">,</span> <span class="bu">root</span><span class="op">.</span><span class="at">height</span> <span class="op">+</span> <span class="dv">1</span>])</span>
<span id="cb6-214"><a href="#cb6-214" aria-hidden="true" tabindex="-1"></a>    (<span class="bu">root</span>)<span class="op">;</span></span>
<span id="cb6-215"><a href="#cb6-215" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-216"><a href="#cb6-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-217"><a href="#cb6-217" aria-hidden="true" tabindex="-1"></a>color <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleOrdinal</span>(</span>
<span id="cb6-218"><a href="#cb6-218" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="fu">quantize</span>(d3<span class="op">.</span><span class="at">interpolateRainbow</span><span class="op">,</span> flareData<span class="op">.</span><span class="at">children</span><span class="op">.</span><span class="at">length</span> <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb6-219"><a href="#cb6-219" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-220"><a href="#cb6-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-221"><a href="#cb6-221" aria-hidden="true" tabindex="-1"></a>format <span class="op">=</span> d3<span class="op">.</span><span class="fu">format</span>(<span class="st">",d"</span>)</span>
<span id="cb6-222"><a href="#cb6-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-223"><a href="#cb6-223" aria-hidden="true" tabindex="-1"></a>width <span class="op">=</span> <span class="dv">932</span></span>
<span id="cb6-224"><a href="#cb6-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-225"><a href="#cb6-225" aria-hidden="true" tabindex="-1"></a>radius <span class="op">=</span> width <span class="op">/</span> <span class="dv">6</span></span>
<span id="cb6-226"><a href="#cb6-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-227"><a href="#cb6-227" aria-hidden="true" tabindex="-1"></a>arc <span class="op">=</span> d3<span class="op">.</span><span class="fu">arc</span>()</span>
<span id="cb6-228"><a href="#cb6-228" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">startAngle</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x0</span>)</span>
<span id="cb6-229"><a href="#cb6-229" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">endAngle</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x1</span>)</span>
<span id="cb6-230"><a href="#cb6-230" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">padAngle</span>(d <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>((d<span class="op">.</span><span class="at">x1</span> <span class="op">-</span> d<span class="op">.</span><span class="at">x0</span>) <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> <span class="fl">0.005</span>))</span>
<span id="cb6-231"><a href="#cb6-231" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">padRadius</span>(radius <span class="op">*</span> <span class="fl">1.5</span>)</span>
<span id="cb6-232"><a href="#cb6-232" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">innerRadius</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">y0</span> <span class="op">*</span> radius)</span>
<span id="cb6-233"><a href="#cb6-233" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">outerRadius</span>(d <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(d<span class="op">.</span><span class="at">y0</span> <span class="op">*</span> radius<span class="op">,</span> d<span class="op">.</span><span class="at">y1</span> <span class="op">*</span> radius <span class="op">-</span> <span class="dv">1</span>))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-7" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</section>
<section id="mapas" class="level2">
<h2 class="anchored" data-anchor-id="mapas">Mapas</h2>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb7" data-startfrom="239" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 238;"><span id="cb7-239"><a href="#cb7-239" aria-hidden="true" tabindex="-1"></a>L <span class="op">=</span> {</span>
<span id="cb7-240"><a href="#cb7-240" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> L <span class="op">=</span> <span class="cf">await</span> <span class="pp">require</span>(<span class="st">"leaflet/dist/leaflet.js"</span>)<span class="op">;</span></span>
<span id="cb7-241"><a href="#cb7-241" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>L<span class="op">.</span><span class="at">_style</span>) {</span>
<span id="cb7-242"><a href="#cb7-242" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> href <span class="op">=</span> <span class="cf">await</span> require<span class="op">.</span><span class="fu">resolve</span>(<span class="st">"leaflet/dist/leaflet.css"</span>)<span class="op">;</span></span>
<span id="cb7-243"><a href="#cb7-243" aria-hidden="true" tabindex="-1"></a>    <span class="bu">document</span><span class="op">.</span><span class="at">head</span><span class="op">.</span><span class="fu">appendChild</span>(L<span class="op">.</span><span class="at">_style</span> <span class="op">=</span> <span class="fu">html</span><span class="vs">`&lt;link href=</span><span class="sc">${</span>href<span class="sc">}</span><span class="vs"> rel=stylesheet&gt;`</span>)<span class="op">;</span></span>
<span id="cb7-244"><a href="#cb7-244" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-245"><a href="#cb7-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-246"><a href="#cb7-246" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> L<span class="op">;</span></span>
<span id="cb7-247"><a href="#cb7-247" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="panel-fill panel-grid">
<div class="g-col-24">
<div class="panel-fill">
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb8" data-startfrom="255" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 254;"><span id="cb8-255"><a href="#cb8-255" aria-hidden="true" tabindex="-1"></a>container <span class="op">=</span> {</span>
<span id="cb8-256"><a href="#cb8-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-257"><a href="#cb8-257" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> x <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"div"</span>)</span>
<span id="cb8-258"><a href="#cb8-258" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-259"><a href="#cb8-259" aria-hidden="true" tabindex="-1"></a>  x<span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="vs">`width:100%;height:</span><span class="sc">${</span><span class="bu">window</span><span class="op">.</span><span class="at">outerHeight</span> <span class="op">*</span> <span class="fl">0.65</span><span class="sc">}</span><span class="vs">px`</span>)<span class="op">;</span></span>
<span id="cb8-260"><a href="#cb8-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-261"><a href="#cb8-261" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> x<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb8-262"><a href="#cb8-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-263"><a href="#cb8-263" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="panel-fill panel-grid">
<div class="g-col-24">
<div class="panel-fill">
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb9" data-startfrom="272" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 271;"><span id="cb9-272"><a href="#cb9-272" aria-hidden="true" tabindex="-1"></a>southwest <span class="op">=</span> {</span>
<span id="cb9-273"><a href="#cb9-273" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-274"><a href="#cb9-274" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> map <span class="op">=</span> L<span class="op">.</span><span class="fu">map</span>(container)<span class="op">;</span></span>
<span id="cb9-275"><a href="#cb9-275" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-276"><a href="#cb9-276" aria-hidden="true" tabindex="-1"></a>  <span class="co">// add basemap layers</span></span>
<span id="cb9-277"><a href="#cb9-277" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> stamen <span class="op">=</span> <span class="st">'Map tiles by &lt;a href="http://stamen.com"&gt;Stamen Design&lt;/a&gt;, &lt;a href="http://creativecommons.org/licenses/by/3.0"&gt;CC BY 3.0&lt;/a&gt; &amp;mdash; Map data &amp;copy; &lt;a href="https://www.openstreetmap.org/copyright"&gt;OpenStreetMap&lt;/a&gt; contributors'</span><span class="op">;</span></span>
<span id="cb9-278"><a href="#cb9-278" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-279"><a href="#cb9-279" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> esri <span class="op">=</span> <span class="st">'Tiles &amp;copy; Esri &amp;mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'</span><span class="op">;</span></span>
<span id="cb9-280"><a href="#cb9-280" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-281"><a href="#cb9-281" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> Stamen_Terrain <span class="op">=</span> L<span class="op">.</span><span class="fu">tileLayer</span>(</span>
<span id="cb9-282"><a href="#cb9-282" aria-hidden="true" tabindex="-1"></a>  <span class="st">'https://stamen-tiles-{s}.a.ssl.fastly.net/terrain/{z}/{x}/{y}{r}.{ext}'</span><span class="op">,</span> </span>
<span id="cb9-283"><a href="#cb9-283" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb9-284"><a href="#cb9-284" aria-hidden="true" tabindex="-1"></a>    <span class="dt">attribution</span><span class="op">:</span> stamen<span class="op">,</span></span>
<span id="cb9-285"><a href="#cb9-285" aria-hidden="true" tabindex="-1"></a>    <span class="dt">subdomains</span><span class="op">:</span> <span class="st">'abcd'</span><span class="op">,</span></span>
<span id="cb9-286"><a href="#cb9-286" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minZoom</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb9-287"><a href="#cb9-287" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maxZoom</span><span class="op">:</span> <span class="dv">18</span><span class="op">,</span></span>
<span id="cb9-288"><a href="#cb9-288" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ext</span><span class="op">:</span> <span class="st">'png'</span></span>
<span id="cb9-289"><a href="#cb9-289" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb9-290"><a href="#cb9-290" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-291"><a href="#cb9-291" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> Stamen_TonerLite <span class="op">=</span> L<span class="op">.</span><span class="fu">tileLayer</span>(</span>
<span id="cb9-292"><a href="#cb9-292" aria-hidden="true" tabindex="-1"></a>  <span class="st">'https://stamen-tiles-{s}.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}{r}.{ext}'</span><span class="op">,</span> </span>
<span id="cb9-293"><a href="#cb9-293" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb9-294"><a href="#cb9-294" aria-hidden="true" tabindex="-1"></a>    <span class="dt">attribution</span><span class="op">:</span> stamen<span class="op">,</span></span>
<span id="cb9-295"><a href="#cb9-295" aria-hidden="true" tabindex="-1"></a>    <span class="dt">subdomains</span><span class="op">:</span> <span class="st">'abcd'</span><span class="op">,</span></span>
<span id="cb9-296"><a href="#cb9-296" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minZoom</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb9-297"><a href="#cb9-297" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maxZoom</span><span class="op">:</span> <span class="dv">18</span><span class="op">,</span></span>
<span id="cb9-298"><a href="#cb9-298" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ext</span><span class="op">:</span> <span class="st">'png'</span></span>
<span id="cb9-299"><a href="#cb9-299" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb9-300"><a href="#cb9-300" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-301"><a href="#cb9-301" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> Esri_WorldImagery <span class="op">=</span> L<span class="op">.</span><span class="fu">tileLayer</span>(</span>
<span id="cb9-302"><a href="#cb9-302" aria-hidden="true" tabindex="-1"></a>  <span class="st">'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}'</span><span class="op">,</span> </span>
<span id="cb9-303"><a href="#cb9-303" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb9-304"><a href="#cb9-304" aria-hidden="true" tabindex="-1"></a>      <span class="dt">attribution</span><span class="op">:</span> esri<span class="op">,</span></span>
<span id="cb9-305"><a href="#cb9-305" aria-hidden="true" tabindex="-1"></a>      <span class="dt">minZoom</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb9-306"><a href="#cb9-306" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maxZoom</span><span class="op">:</span> <span class="dv">18</span><span class="op">,</span></span>
<span id="cb9-307"><a href="#cb9-307" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ext</span><span class="op">:</span> <span class="st">'png'</span></span>
<span id="cb9-308"><a href="#cb9-308" aria-hidden="true" tabindex="-1"></a>  })<span class="op">.</span><span class="fu">addTo</span>(map)<span class="op">;</span></span>
<span id="cb9-309"><a href="#cb9-309" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-310"><a href="#cb9-310" aria-hidden="true" tabindex="-1"></a>  <span class="co">// button to toggle basemap layer selection</span></span>
<span id="cb9-311"><a href="#cb9-311" aria-hidden="true" tabindex="-1"></a>  L<span class="op">.</span><span class="at">control</span><span class="op">.</span><span class="fu">layers</span>(</span>
<span id="cb9-312"><a href="#cb9-312" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb9-313"><a href="#cb9-313" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Stamen Terrain"</span><span class="op">:</span> Stamen_Terrain<span class="op">,</span></span>
<span id="cb9-314"><a href="#cb9-314" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Stamen TonerLite"</span><span class="op">:</span> Stamen_TonerLite<span class="op">,</span></span>
<span id="cb9-315"><a href="#cb9-315" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Esri World Imagery"</span><span class="op">:</span> Esri_WorldImagery</span>
<span id="cb9-316"><a href="#cb9-316" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb9-317"><a href="#cb9-317" aria-hidden="true" tabindex="-1"></a>    <span class="kw">null</span><span class="op">,</span></span>
<span id="cb9-318"><a href="#cb9-318" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">position</span><span class="op">:</span> <span class="st">'topleft'</span>}</span>
<span id="cb9-319"><a href="#cb9-319" aria-hidden="true" tabindex="-1"></a>  )<span class="op">.</span><span class="fu">addTo</span>(map)<span class="op">;</span></span>
<span id="cb9-320"><a href="#cb9-320" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-321"><a href="#cb9-321" aria-hidden="true" tabindex="-1"></a>  L<span class="op">.</span><span class="at">control</span><span class="op">.</span><span class="fu">scale</span>()<span class="op">.</span><span class="fu">addTo</span>(map)<span class="op">;</span></span>
<span id="cb9-322"><a href="#cb9-322" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-323"><a href="#cb9-323" aria-hidden="true" tabindex="-1"></a>  map<span class="op">.</span><span class="fu">setView</span>([<span class="fl">19.5438</span><span class="op">,</span> <span class="op">-</span><span class="fl">96.9102</span>]<span class="op">,</span> <span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb9-324"><a href="#cb9-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-325"><a href="#cb9-325" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> map<span class="op">;</span> </span>
<span id="cb9-326"><a href="#cb9-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-327"><a href="#cb9-327" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell card bg-light p-2 g-col-24 g-col-lg-7">
<div class="sourceCode cell-code" id="cb10" data-startfrom="337" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 336;"><span id="cb10-337"><a href="#cb10-337" aria-hidden="true" tabindex="-1"></a>viewof year <span class="op">=</span>  Inputs<span class="op">.</span><span class="fu">range</span>(</span>
<span id="cb10-338"><a href="#cb10-338" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1990</span><span class="op">,</span> <span class="dv">2019</span>]<span class="op">,</span> </span>
<span id="cb10-339"><a href="#cb10-339" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">value</span><span class="op">:</span> <span class="dv">2019</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Año"</span>}</span>
<span id="cb10-340"><a href="#cb10-340" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-341"><a href="#cb10-341" aria-hidden="true" tabindex="-1"></a>viewof k <span class="op">=</span>  Inputs<span class="op">.</span><span class="fu">range</span>(</span>
<span id="cb10-342"><a href="#cb10-342" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">20</span><span class="op">,</span> <span class="dv">100</span>]<span class="op">,</span> </span>
<span id="cb10-343"><a href="#cb10-343" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">value</span><span class="op">:</span> <span class="dv">50</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Radio max"</span>}</span>
<span id="cb10-344"><a href="#cb10-344" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-345"><a href="#cb10-345" aria-hidden="true" tabindex="-1"></a>meta <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"data/worldbank_meta.csv"</span>)<span class="op">.</span><span class="fu">csv</span>()</span>
<span id="cb10-346"><a href="#cb10-346" aria-hidden="true" tabindex="-1"></a>viewof indicator <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(</span>
<span id="cb10-347"><a href="#cb10-347" aria-hidden="true" tabindex="-1"></a>  <span class="kw">new</span> <span class="bu">Map</span>(meta<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> [d<span class="op">.</span><span class="at">indicator</span><span class="op">,</span> d<span class="op">.</span><span class="at">shortcode</span>]))<span class="op">,</span></span>
<span id="cb10-348"><a href="#cb10-348" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">label</span><span class="op">:</span> <span class="st">"Indicador"</span> }</span>
<span id="cb10-349"><a href="#cb10-349" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-350"><a href="#cb10-350" aria-hidden="true" tabindex="-1"></a>projections <span class="op">=</span> [<span class="st">"Patterson"</span><span class="op">,</span> <span class="st">"NaturalEarth1"</span><span class="op">,</span> <span class="st">"Bertin1953"</span><span class="op">,</span> <span class="st">"InterruptedSinusoidal"</span><span class="op">,</span> <span class="st">"Armadillo"</span><span class="op">,</span> <span class="st">"Baker"</span><span class="op">,</span> <span class="st">"Gingery"</span><span class="op">,</span> <span class="st">"Berghaus"</span><span class="op">,</span> <span class="st">"Loximuthal"</span><span class="op">,</span> <span class="st">"Healpix"</span><span class="op">,</span> <span class="st">"InterruptedMollweideHemispheres"</span><span class="op">,</span> <span class="st">"Miller"</span><span class="op">,</span> <span class="st">"Aitoff"</span><span class="op">,</span> <span class="st">"ConicEqualArea"</span><span class="op">,</span> <span class="st">"Eckert3"</span><span class="op">,</span> <span class="st">"Hill"</span>]</span>
<span id="cb10-351"><a href="#cb10-351" aria-hidden="true" tabindex="-1"></a>viewof proj <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(projections<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Proyección"</span><span class="op">,</span> <span class="dt">width</span><span class="op">:</span> <span class="dv">350</span>})</span>
<span id="cb10-352"><a href="#cb10-352" aria-hidden="true" tabindex="-1"></a>viewof color1 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">color</span>({<span class="dt">label</span><span class="op">:</span> <span class="st">"color"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="st">"#4682b4"</span>})</span>
<span id="cb10-353"><a href="#cb10-353" aria-hidden="true" tabindex="-1"></a>viewof simpl <span class="op">=</span>  Inputs<span class="op">.</span><span class="fu">range</span>( [<span class="fl">0.01</span><span class="op">,</span> <span class="fl">0.5</span>]<span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> <span class="fl">0.1</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Simplificación"</span>} )</span>
<span id="cb10-354"><a href="#cb10-354" aria-hidden="true" tabindex="-1"></a>viewof x <span class="op">=</span>  Inputs<span class="op">.</span><span class="fu">range</span>( [<span class="op">-</span><span class="dv">180</span><span class="op">,</span> <span class="dv">180</span>]<span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Rotation (x)"</span>} )</span>
<span id="cb10-355"><a href="#cb10-355" aria-hidden="true" tabindex="-1"></a>viewof y <span class="op">=</span>  Inputs<span class="op">.</span><span class="fu">range</span>( [<span class="op">-</span><span class="dv">90</span><span class="op">,</span> <span class="dv">90</span>]<span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Rotation (y)"</span>} )</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-10-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-10-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-10-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-10-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-10-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-10-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-10-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-10-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-10-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-10-10" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb11" data-startfrom="359" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 358;"><span id="cb11-359"><a href="#cb11-359" aria-hidden="true" tabindex="-1"></a>bertin<span class="op">.</span><span class="fu">draw</span>({</span>
<span id="cb11-360"><a href="#cb11-360" aria-hidden="true" tabindex="-1"></a><span class="dt">params</span><span class="op">:</span> {<span class="dt">projection</span><span class="op">:</span> proj <span class="op">+</span> <span class="vs">`.rotate([</span><span class="sc">${</span>x<span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>y<span class="sc">}</span><span class="vs">])`</span><span class="op">,</span> <span class="dt">clip</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span> </span>
<span id="cb11-361"><a href="#cb11-361" aria-hidden="true" tabindex="-1"></a><span class="dt">layers</span><span class="op">:</span>[</span>
<span id="cb11-362"><a href="#cb11-362" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">type</span> <span class="op">:</span> <span class="st">"header"</span><span class="op">,</span> <span class="dt">text</span><span class="op">:</span> title}<span class="op">,</span></span>
<span id="cb11-363"><a href="#cb11-363" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">type</span><span class="op">:</span> <span class="st">"bubble"</span><span class="op">,</span> <span class="dt">geojson</span><span class="op">:</span> data<span class="op">,</span> <span class="dt">values</span><span class="op">:</span> indicator<span class="op">,</span> </span>
<span id="cb11-364"><a href="#cb11-364" aria-hidden="true" tabindex="-1"></a>  <span class="dt">fill</span><span class="op">:</span> color1<span class="op">,</span> <span class="dt">fixmax</span><span class="op">:</span> varmax<span class="op">,</span> k<span class="op">,</span> </span>
<span id="cb11-365"><a href="#cb11-365" aria-hidden="true" tabindex="-1"></a>  <span class="dt">tooltip</span><span class="op">:</span> [<span class="st">"$name"</span><span class="op">,</span>d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">properties</span>[indicator]]}<span class="op">,</span></span>
<span id="cb11-366"><a href="#cb11-366" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">geojson</span><span class="op">:</span> world2<span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"#CCC"</span>}<span class="op">,</span></span>
<span id="cb11-367"><a href="#cb11-367" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">type</span><span class="op">:</span> <span class="st">"graticule"</span>}<span class="op">,</span>  </span>
<span id="cb11-368"><a href="#cb11-368" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">type</span><span class="op">:</span> <span class="st">"outline"</span>}</span>
<span id="cb11-369"><a href="#cb11-369" aria-hidden="true" tabindex="-1"></a>]})</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-11" data-nodetype="expression">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" data-startfrom="374" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 373;"><span id="cb12-374"><a href="#cb12-374" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">table</span>(statsyear<span class="op">,</span> {  <span class="dt">columns</span><span class="op">:</span> [</span>
<span id="cb12-375"><a href="#cb12-375" aria-hidden="true" tabindex="-1"></a>    <span class="st">"country"</span><span class="op">,</span></span>
<span id="cb12-376"><a href="#cb12-376" aria-hidden="true" tabindex="-1"></a>    <span class="st">"capital_city"</span><span class="op">,</span></span>
<span id="cb12-377"><a href="#cb12-377" aria-hidden="true" tabindex="-1"></a>    <span class="st">"region"</span><span class="op">,</span></span>
<span id="cb12-378"><a href="#cb12-378" aria-hidden="true" tabindex="-1"></a>    indicator</span>
<span id="cb12-379"><a href="#cb12-379" aria-hidden="true" tabindex="-1"></a>  ]})</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-12" data-nodetype="expression">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb13" data-startfrom="386" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 385;"><span id="cb13-386"><a href="#cb13-386" aria-hidden="true" tabindex="-1"></a>viewof topnb <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">5</span><span class="op">,</span> <span class="dv">30</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Número de países a mostrar"</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span>})</span>
<span id="cb13-387"><a href="#cb13-387" aria-hidden="true" tabindex="-1"></a>top <span class="op">=</span> statsyear<span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> d3<span class="op">.</span><span class="fu">descending</span>(<span class="op">+</span>a[indicator]<span class="op">,</span> <span class="op">+</span>b[indicator]))</span>
<span id="cb13-388"><a href="#cb13-388" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">slice</span>(<span class="dv">0</span><span class="op">,</span> topnb)</span>
<span id="cb13-389"><a href="#cb13-389" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb13-390"><a href="#cb13-390" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marginLeft</span><span class="op">:</span> <span class="dv">60</span><span class="op">,</span></span>
<span id="cb13-391"><a href="#cb13-391" aria-hidden="true" tabindex="-1"></a>      <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb13-392"><a href="#cb13-392" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> {</span>
<span id="cb13-393"><a href="#cb13-393" aria-hidden="true" tabindex="-1"></a>    <span class="co">//type: "log",</span></span>
<span id="cb13-394"><a href="#cb13-394" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Años →"</span></span>
<span id="cb13-395"><a href="#cb13-395" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb13-396"><a href="#cb13-396" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb13-397"><a href="#cb13-397" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"↑ Población"</span><span class="op">,</span></span>
<span id="cb13-398"><a href="#cb13-398" aria-hidden="true" tabindex="-1"></a>    <span class="co">//type: "log",</span></span>
<span id="cb13-399"><a href="#cb13-399" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb13-400"><a href="#cb13-400" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb13-401"><a href="#cb13-401" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">barY</span>(top<span class="op">,</span> {</span>
<span id="cb13-402"><a href="#cb13-402" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"iso3c"</span><span class="op">,</span></span>
<span id="cb13-403"><a href="#cb13-403" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> indicator<span class="op">,</span></span>
<span id="cb13-404"><a href="#cb13-404" aria-hidden="true" tabindex="-1"></a>      <span class="dt">sort</span><span class="op">:</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"y"</span><span class="op">,</span> <span class="dt">reverse</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb13-405"><a href="#cb13-405" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> color1</span>
<span id="cb13-406"><a href="#cb13-406" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb13-407"><a href="#cb13-407" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">ruleY</span>([<span class="dv">0</span>])</span>
<span id="cb13-408"><a href="#cb13-408" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb13-409"><a href="#cb13-409" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-13-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-13-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-13-3" data-nodetype="expression">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb14" data-startfrom="415" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 414;"><span id="cb14-415"><a href="#cb14-415" aria-hidden="true" tabindex="-1"></a>world <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"data/world.json"</span>)<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb14-416"><a href="#cb14-416" aria-hidden="true" tabindex="-1"></a>stats <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"data/worldbank_data.csv"</span>)<span class="op">.</span><span class="fu">csv</span>()</span>
<span id="cb14-417"><a href="#cb14-417" aria-hidden="true" tabindex="-1"></a>geo <span class="op">=</span> <span class="pp">require</span>(<span class="st">"geotoolbox.js"</span>)</span>
<span id="cb14-418"><a href="#cb14-418" aria-hidden="true" tabindex="-1"></a>world2 <span class="op">=</span> geo<span class="op">.</span><span class="fu">simplify</span>(world<span class="op">,</span> {<span class="dt">k</span><span class="op">:</span> simpl})</span>
<span id="cb14-419"><a href="#cb14-419" aria-hidden="true" tabindex="-1"></a>bertin <span class="op">=</span> <span class="pp">require</span>(<span class="st">"bertin.js"</span>)</span>
<span id="cb14-420"><a href="#cb14-420" aria-hidden="true" tabindex="-1"></a>statsyear <span class="op">=</span> stats<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">date</span> <span class="op">==</span> year)</span>
<span id="cb14-421"><a href="#cb14-421" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> bertin<span class="op">.</span><span class="fu">merge</span>(world2<span class="op">,</span> <span class="st">"id"</span><span class="op">,</span> statsyear<span class="op">,</span> <span class="st">"iso3c"</span>)</span>
<span id="cb14-422"><a href="#cb14-422" aria-hidden="true" tabindex="-1"></a>varmax <span class="op">=</span> d3<span class="op">.</span><span class="fu">max</span>(stats<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">date</span> <span class="op">==</span> <span class="dv">2019</span>)<span class="op">,</span> d <span class="kw">=&gt;</span> <span class="op">+</span>d[indicator])</span>
<span id="cb14-423"><a href="#cb14-423" aria-hidden="true" tabindex="-1"></a>title <span class="op">=</span> meta<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> [d<span class="op">.</span><span class="at">indicator</span><span class="op">,</span> d<span class="op">.</span><span class="at">shortcode</span>])<span class="op">.</span><span class="fu">find</span>((d) <span class="kw">=&gt;</span> d[<span class="dv">1</span>] <span class="op">==</span> indicator)[<span class="dv">0</span>] <span class="op">+</span> <span class="st">" in "</span> <span class="op">+</span> year</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-14-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-14-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-14-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-14-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-14-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-14-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-14-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-14-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-14-9" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>


</section>

</main> <!-- /main -->

<script type="ojs-module-contents">
{"contents":[{"methodName":"interpret","cellName":"ojs-cell-1","inline":false,"source":"viewof tabla = Inputs.radio(\n  [\n    \"drive_folders\",\n    \"drive_files\",\n    \"drive_users\",\n    \"conceptos\",\n    \"tema_doc\",\n  ], \n  { label: \"Tabla:\", value: \"drive_folders\"}\n)\n\n"},{"methodName":"interpret","cellName":"ojs-cell-2","inline":false,"source":"db = FileAttachment(\"pronaces.db\").sqlite()\n\ndb.describe(tabla)\n\n"},{"methodName":"interpret","cellName":"ojs-cell-3","inline":false,"source":"\nsql_id = \"SELECT id, name FROM drive_folders WHERE  name LIKE '%Libro semillas%'\"\n\nresultado_1 = db.query(sql_id)\n\nInputs.table(resultado_1, {  columns: [\"name\", \"id\"]})\n"},{"methodName":"interpret","cellName":"ojs-cell-4","inline":false,"source":"\nsql_base = \"SELECT name, mimeType FROM drive_files WHERE _parent = '1uOrhAvjddeDxgyfIyDaoyKNivp63vUvO'\"\n\nviewof consulta = Inputs.textarea({label: \"Consulta\", \n                            placeholder: \"Ingresa una consulta SQL\", \n                            value: sql_base, \n                            submit: true})\n\n\nfld_interes = db.query(consulta)\n\nInputs.table(fld_interes, {  columns: [\n    \"name\", \"mimeType\"]})\n"},{"methodName":"interpret","cellName":"ojs-cell-5","inline":false,"source":"\nsunburst = {\n  const root = partition(flareData);\n\n  root.each(d => d.current = d);\n\n  const svg = d3.create(\"svg\")\n      .attr(\"viewBox\", [0, 0, width, width])\n      .style(\"font\", \"15px sans-serif\");\n\n  const g = svg.append(\"g\")\n      .attr(\"transform\", `translate(${width / 2},${width / 2})`);\n\n  const path = g.append(\"g\")\n    .selectAll(\"path\")\n    .data(root.descendants().slice(1))\n    .join(\"path\")\n      .attr(\"fill\", d => { while (d.depth > 1) d = d.parent; return color(d.data.name); })\n      .attr(\"fill-opacity\", d => arcVisible(d.current) ? (d.children ? 0.6 : 0.4) : 0)\n      .attr(\"d\", d => arc(d.current));\n\n  path.filter(d => d.children)\n      .style(\"cursor\", \"pointer\")\n      .on(\"click\", clicked);\n\n  path.append(\"title\")\n      .text(d => `${d.ancestors().map(d => d.data.name).reverse().join(\"/\")}\\n${format(d.value)}`);\n\n  const label = g.append(\"g\")\n      .attr(\"pointer-events\", \"none\")\n      .attr(\"text-anchor\", \"middle\")\n      .style(\"user-select\", \"none\")\n    .selectAll(\"text\")\n    .data(root.descendants().slice(1))\n    .join(\"text\")\n      .attr(\"dy\", \"0.35em\")\n      .attr(\"fill-opacity\", d => +labelVisible(d.current))\n      .attr(\"transform\", d => labelTransform(d.current))\n      .text(d => d.data.name);\n\n  const parent = g.append(\"circle\")\n      .datum(root)\n      .attr(\"r\", radius)\n      .attr(\"fill\", \"none\")\n      .attr(\"pointer-events\", \"all\")\n      .on(\"click\", clicked);\n\n  function clicked(event, p) {\n    parent.datum(p.parent || root);\n\n    root.each(d => d.target = {\n      x0: Math.max(0, Math.min(1, (d.x0 - p.x0) / (p.x1 - p.x0))) * 2 * Math.PI,\n      x1: Math.max(0, Math.min(1, (d.x1 - p.x0) / (p.x1 - p.x0))) * 2 * Math.PI,\n      y0: Math.max(0, d.y0 - p.depth),\n      y1: Math.max(0, d.y1 - p.depth)\n    });\n\n    const t = g.transition().duration(750);\n\n    // Transition the data on all arcs, even the ones that aren’t visible,\n    // so that if this transition is interrupted, entering arcs will start\n    // the next transition from the desired position.\n    path.transition(t)\n        .tween(\"data\", d => {\n          const i = d3.interpolate(d.current, d.target);\n          return t => d.current = i(t);\n        })\n      .filter(function(d) {\n        return +this.getAttribute(\"fill-opacity\") || arcVisible(d.target);\n      })\n        .attr(\"fill-opacity\", d => arcVisible(d.target) ? (d.children ? 0.6 : 0.4) : 0)\n        .attrTween(\"d\", d => () => arc(d.current));\n\n    label.filter(function(d) {\n        return +this.getAttribute(\"fill-opacity\") || labelVisible(d.target);\n      }).transition(t)\n        .attr(\"fill-opacity\", d => +labelVisible(d.target))\n        .attrTween(\"transform\", d => () => labelTransform(d.current));\n  }\n  \n  function arcVisible(d) {\n    return d.y1 <= 3 && d.y0 >= 1 && d.x1 > d.x0;\n  }\n\n  function labelVisible(d) {\n    return d.y1 <= 3 && d.y0 >= 1 && (d.y1 - d.y0) * (d.x1 - d.x0) > 0.03;\n  }\n\n  function labelTransform(d) {\n    const x = (d.x0 + d.x1) / 2 * 180 / Math.PI;\n    const y = (d.y0 + d.y1) / 2 * radius;\n    return `rotate(${x - 90}) translate(${y},0) rotate(${x < 180 ? 0 : 180})`;\n  }\n\n  return svg.node();\n}\n"},{"methodName":"interpret","cellName":"ojs-cell-6","inline":false,"source":"\nflareData = FileAttachment(\"data/flare-2.json\").json()\n\npartition = flareData => {\n  const root = d3.hierarchy(flareData)\n      .sum(d => d.value)\n      .sort((a, b) => b.value - a.value);\n  return d3.partition()\n      .size([2 * Math.PI, root.height + 1])\n    (root);\n}\n\ncolor = d3.scaleOrdinal(\n  d3.quantize(d3.interpolateRainbow, flareData.children.length + 1)\n)\n\nformat = d3.format(\",d\")\n\nwidth = 932\n\nradius = width / 6\n\narc = d3.arc()\n    .startAngle(d => d.x0)\n    .endAngle(d => d.x1)\n    .padAngle(d => Math.min((d.x1 - d.x0) / 2, 0.005))\n    .padRadius(radius * 1.5)\n    .innerRadius(d => d.y0 * radius)\n    .outerRadius(d => Math.max(d.y0 * radius, d.y1 * radius - 1))\n"},{"methodName":"interpret","cellName":"ojs-cell-7","inline":false,"source":"\nL = {\n  const L = await require(\"leaflet/dist/leaflet.js\");\n  if (!L._style) {\n    const href = await require.resolve(\"leaflet/dist/leaflet.css\");\n    document.head.appendChild(L._style = html`<link href=${href} rel=stylesheet>`);\n  }\n\n  return L;\n};\n\n"},{"methodName":"interpret","cellName":"ojs-cell-8","inline":false,"source":"\n\ncontainer = {\n\n  let x = d3.create(\"div\")\n  \n  x.attr(\"style\", `width:100%;height:${window.outerHeight * 0.65}px`);\n\n  return x.node();\n\n}\n\n"},{"methodName":"interpret","cellName":"ojs-cell-9","inline":false,"source":"\n\nsouthwest = {\n  \n  let map = L.map(container);\n  \n  // add basemap layers\n  const stamen = 'Map tiles by <a href=\"http://stamen.com\">Stamen Design</a>, <a href=\"http://creativecommons.org/licenses/by/3.0\">CC BY 3.0</a> &mdash; Map data &copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors';\n  \n  const esri = 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community';\n  \n  const Stamen_Terrain = L.tileLayer(\n  'https://stamen-tiles-{s}.a.ssl.fastly.net/terrain/{z}/{x}/{y}{r}.{ext}', \n  {\n  \tattribution: stamen,\n  \tsubdomains: 'abcd',\n  \tminZoom: 0,\n  \tmaxZoom: 18,\n  \text: 'png'\n  });\n  \n  const Stamen_TonerLite = L.tileLayer(\n  'https://stamen-tiles-{s}.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}{r}.{ext}', \n  {\n    attribution: stamen,\n  \tsubdomains: 'abcd',\n  \tminZoom: 0,\n  \tmaxZoom: 18,\n    ext: 'png'\n  });\n  \n  const Esri_WorldImagery = L.tileLayer(\n  'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', \n  {\n\t  attribution: esri,\n\t  minZoom: 0,\n  \tmaxZoom: 18,\n    ext: 'png'\n  }).addTo(map);\n  \n  // button to toggle basemap layer selection\n  L.control.layers(\n    {\n      \"Stamen Terrain\": Stamen_Terrain,\n      \"Stamen TonerLite\": Stamen_TonerLite,\n      \"Esri World Imagery\": Esri_WorldImagery\n    },\n    null,\n    {position: 'topleft'}\n  ).addTo(map);\n  \n  L.control.scale().addTo(map);\n  \n  map.setView([19.5438, -96.9102], 5);\n\n  return map; \n\n};\n\n"},{"methodName":"interpret","cellName":"ojs-cell-10","inline":false,"source":"\nviewof year =  Inputs.range(\n  [1990, 2019], \n  {value: 2019, step: 1, label: \"Año\"}\n)\nviewof k =  Inputs.range(\n  [20, 100], \n  {value: 50, step: 1, label: \"Radio max\"}\n)\nmeta = FileAttachment(\"data/worldbank_meta.csv\").csv()\nviewof indicator = Inputs.select(\n  new Map(meta.map((d) => [d.indicator, d.shortcode])),\n  { label: \"Indicador\" }\n)\nprojections = [\"Patterson\", \"NaturalEarth1\", \"Bertin1953\", \"InterruptedSinusoidal\", \"Armadillo\", \"Baker\", \"Gingery\", \"Berghaus\", \"Loximuthal\", \"Healpix\", \"InterruptedMollweideHemispheres\", \"Miller\", \"Aitoff\", \"ConicEqualArea\", \"Eckert3\", \"Hill\"]\nviewof proj = Inputs.select(projections, {label: \"Proyección\", width: 350})\nviewof color1 = Inputs.color({label: \"color\", value: \"#4682b4\"})\nviewof simpl =  Inputs.range( [0.01, 0.5], {value: 0.1, step: 0.01, label: \"Simplificación\"} )\nviewof x =  Inputs.range( [-180, 180], {value: 0, step: 1, label: \"Rotation (x)\"} )\nviewof y =  Inputs.range( [-90, 90], {value: 0, step: 1, label: \"Rotation (y)\"} )\n"},{"methodName":"interpret","cellName":"ojs-cell-11","inline":false,"source":"\nbertin.draw({\nparams: {projection: proj + `.rotate([${x}, ${y}])`, clip: true }, \nlayers:[\n  { type : \"header\", text: title},\n  {type: \"bubble\", geojson: data, values: indicator, \n  fill: color1, fixmax: varmax, k, \n  tooltip: [\"$name\",d => d.properties[indicator]]},\n  {geojson: world2, fill: \"#CCC\"},\n  {type: \"graticule\"},  \n  {type: \"outline\"}\n]})\n"},{"methodName":"interpret","cellName":"ojs-cell-12","inline":false,"source":"Inputs.table(statsyear, {  columns: [\n    \"country\",\n    \"capital_city\",\n    \"region\",\n    indicator\n  ]})\n"},{"methodName":"interpret","cellName":"ojs-cell-13","inline":false,"source":"\nviewof topnb = Inputs.range([5, 30], {label: \"Número de países a mostrar\", step: 1})\ntop = statsyear.sort((a, b) => d3.descending(+a[indicator], +b[indicator]))\n  .slice(0, topnb)\nPlot.plot({\n    marginLeft: 60,\n      grid: true,\n  x: {\n    //type: \"log\",\n    label: \"Años →\"\n  },\n  y: {\n    label: \"↑ Población\",\n    //type: \"log\",\n  },\n  marks: [\n    Plot.barY(top, {\n      x: \"iso3c\",\n      y: indicator,\n      sort: { x: \"y\", reverse: true },\n      fill: color1\n    }),\n    Plot.ruleY([0])\n  ]\n})\n"},{"methodName":"interpret","cellName":"ojs-cell-14","inline":false,"source":"\nworld = FileAttachment(\"data/world.json\").json()\nstats = FileAttachment(\"data/worldbank_data.csv\").csv()\ngeo = require(\"geotoolbox.js\")\nworld2 = geo.simplify(world, {k: simpl})\nbertin = require(\"bertin.js\")\nstatsyear = stats.filter(d => d.date == year)\ndata = bertin.merge(world2, \"id\", statsyear, \"iso3c\")\nvarmax = d3.max(stats.filter(d => d.date == 2019), d => +d[indicator])\ntitle = meta.map((d) => [d.indicator, d.shortcode]).find((d) => d[1] == indicator)[0] + \" in \" + year\n"},{"methodName":"interpretQuiet","source":"shinyInput('tabla')"},{"methodName":"interpretQuiet","source":"shinyInput('consulta')"},{"methodName":"interpretQuiet","source":"shinyInput('year')"},{"methodName":"interpretQuiet","source":"shinyInput('k')"},{"methodName":"interpretQuiet","source":"shinyInput('indicator')"},{"methodName":"interpretQuiet","source":"shinyInput('proj')"},{"methodName":"interpretQuiet","source":"shinyInput('color1')"},{"methodName":"interpretQuiet","source":"shinyInput('simpl')"},{"methodName":"interpretQuiet","source":"shinyInput('x')"},{"methodName":"interpretQuiet","source":"shinyInput('y')"},{"methodName":"interpretQuiet","source":"shinyInput('topnb')"}]}
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../../posts/gs-sqlite-contenido";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "../..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiado");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiado");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>